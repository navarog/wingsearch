<mat-expansion-panel (window:resize)="onResize()">
    <mat-expansion-panel-header collapsedHeight="84px" expandedHeight="84px">
        <mat-panel-title>
            <mat-form-field appearance="standard" (click)="$event.cancelBubble = true">
                <mat-label>
                    <picture>
                        <source type="image/webp" srcset="assets/icons/png/flocking.webp">
                        <source type="image/png" srcset="assets/icons/png/flocking.png">
                        <img class="input-image" src="assets/icons/png/flocking.png" alt="flocking" aria-hidden="true">
                    </picture>
                    Search birds and bonus cards
                </mat-label>
                <input matInput autocomplete="off" [(ngModel)]='query.main' (ngModelChange)="onQueryChange()"
                    (keydown)="onKeyDown($event)">
                <button mat-icon-button *ngIf="query.main" matSuffix aria-label="Clear"
                    (click)="query.main=''; onQueryChange()">
                    <mat-icon>close</mat-icon>
                </button>
                <mat-hint>Use card name or description</mat-hint>
            </mat-form-field>
            <app-stats *ngIf="canFitStats" [mobile]="false" [statsControls]="query.stats"
                (statsChange)="onStatsChange($event)"></app-stats>
        </mat-panel-title>
    </mat-expansion-panel-header>
    <mat-form-field class="long-field" appearance="standard">
        <mat-label>
            <picture>
                <source type="image/webp" srcset="assets/cards/backgrounds/bonus-background.webp">
                <source type="image/jpeg" srcset="assets/cards/backgrounds/bonus-background.jpg">
                <img class="input-image" src="assets/cards/backgrounds/bonus-background.jpg" alt="bonus background"
                    aria-hidden="true">
            </picture>
            Search birds by applicable bonus cards
        </mat-label>
        <mat-hint>Use bonus card name or condition</mat-hint>
        <mat-chip-list #chipList aria-label="Bonus cards selection">
            <mat-chip class="custom-chip" *ngFor="let card of query.bonus" [removable]="true"
                (removed)="removeBonus(card)">
                {{card}}
                <mat-icon matChipRemove>cancel</mat-icon>
            </mat-chip>
            <input #bonusInput [matChipInputFor]="chipList" type="text" matInput [formControl]="bonusControl"
                [matAutocomplete]="auto" (matChipInputTokenEnd)="bonusControl.setValue(''); bonusInput.value = ''"
                (click)="openPanel()">
            <button mat-icon-button *ngIf="bonusControl.value || query.bonus.length" matSuffix aria-label="Clear"
                (click)="bonusControl.setValue(''); bonusInput.value = ''; query.bonus=[]; onBonusChange(); onQueryChange()">
                <mat-icon>close</mat-icon>
            </button>
        </mat-chip-list>
        <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete"
            (optionSelected)="addBonus($event); bonusInput.value = ''">
            <mat-option class="bonus-card-option" *ngFor="let card of filteredBonusCards | async"
                [value]="card['Name']">
                <app-bonus-card-option [card]="card"></app-bonus-card-option>
            </mat-option>
        </mat-autocomplete>
    </mat-form-field>
    <div class="row justify-content-unset" matTooltip="Toggle birds with specific power color">
        <span class="pointer shrink" [ngClass]="{inactive: !query.colors.brown}" (click)="togglePower('brown')">
            <picture>
                <source type="image/webp" srcset="assets/icons/png/brown.webp">
                <source type="image/png" srcset="assets/icons/png/brown.png">
                <img class="power-image" src="assets/icons/png/brown.png" aria-hidden="false"
                    aria-label="Toggle brown power" alt="brown power">
            </picture>
        </span>
        <span class="pointer shrink" [ngClass]="{inactive: !query.colors.pink}" (click)="togglePower('pink')">
            <picture>
                <source type="image/webp" srcset="assets/icons/png/pink.webp">
                <source type="image/png" srcset="assets/icons/png/pink.png">
                <img class="power-image" src="assets/icons/png/pink.png" aria-hidden="false"
                    aria-label="Toggle pink power" alt="pink power">
            </picture>
        </span>
        <span class="pointer shrink" [ngClass]="{inactive: !query.colors.white}" (click)="togglePower('white')">
            <picture>
                <source type="image/webp" srcset="assets/icons/png/white.webp">
                <source type="image/png" srcset="assets/icons/png/white.png">
                <img class="power-image" src="assets/icons/png/white.png" aria-hidden="false"
                    aria-label="Toggle white power" alt="white power">
            </picture>
        </span>
        <span class="pointer shrink" [ngClass]="{inactive: !query.colors.teal}" (click)="togglePower('teal')">
            <picture>
                <source type="image/webp" srcset="assets/icons/png/teal.webp">
                <source type="image/png" srcset="assets/icons/png/teal.png">
                <img class="power-image" src="assets/icons/png/teal.png" aria-hidden="false"
                    aria-label="Toggle teal power" alt="teal power">
            </picture>
        </span>
    </div>
    <div class="row">
        <span class="slider-wrapper">
            <div class="custom-slider" style="max-width: 272px">
                <ng5-slider [(value)]="eggs.min" [(highValue)]="eggs.max" [options]="eggOptions"
                    (userChangeEnd)="onEggsChange()"></ng5-slider>
            </div>
            <picture>
                <source type="image/webp" srcset="assets/icons/png/egg.webp">
                <source type="image/png" srcset="assets/icons/png/egg.png">
                <img src="assets/icons/png/egg.png" alt="egg" aria-hidden="false"
                    matTooltip="Filter by the egg capacity" aria-label="Select number of eggs"
                    style="max-height: 24px; width: auto; margin-left: 10px">
            </picture>
        </span>
        <span class="clickable" [ngClass]="{inactive: !query.expansion.european}" (click)="toggleExpansion('european');"
            matTooltip="Toggle if you don't play with that expansion">
            <picture>
                <source type="image/webp" srcset="assets/icons/png/european.webp">
                <source type="image/png" srcset="assets/icons/png/european.png">
                <img class="expansion-image" src="assets/icons/png/european.png" aria-hidden="false"
                    aria-label="Toggle european expansion" alt="european expansion">
            </picture>
            <div class="description"> European expansion</div>
        </span>
    </div>
    <div class="row">
        <span class="slider-wrapper">
            <div class="custom-slider" style="max-width: 400px">
                <ng5-slider [(value)]="points.min" [(highValue)]="points.max" [options]="pointOptions"
                    (userChangeEnd)="onPointsChange()"></ng5-slider>
            </div>
            <picture>
                <source type="image/webp" srcset="assets/icons/png/point.webp">
                <source type="image/png" srcset="assets/icons/png/point.png">
                <img src="assets/icons/png/point.png" alt="point" aria-hidden="false"
                    matTooltip="Filter by the number of points" aria-label="Select number of points"
                    style="max-height: 34px; width: auto; margin-left: 10px">
            </picture>
        </span>
        <button mat-raised-button color="primary" aria-label="Reset all filters"
            (click)="clearFilter(); bonusInput.value = ''" matTooltip="Reset all filters (except expansions)">
            Reset <mat-icon>filter_alt</mat-icon>
        </button>
    </div>
    <app-stats *ngIf="!canFitStats" [mobile]="true" [statsControls]="query.stats" (statsChange)="onStatsChange($event)">
    </app-stats>
</mat-expansion-panel>